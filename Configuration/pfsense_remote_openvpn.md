# Setting up remote OpenVPN
If your CPU support AES encryption:
1. go to **System** > **Advanced** > **Miscellaneous**
![](/Images/pfsense_1.png)
2. Set Cryptographic Hardware to `AES-NI CPU-based Accessleration`
![](/Images/pfsense_2.png)
3. Save
## Add SSL VPN for mobile clients
1. Go to **VPN** > **OpenVPN** > **Wizards**
![](/Images/pfsense_3.png)
2. Select Type of Server to `Local User Access` and press **Next**
![](/Images/pfsense_5.png)
3. Create a new Certificate Authority (CA), setting the Description Name and Key Length (i'm using 2048)
![](/Images/pfsense_4.png)
4. Then fill the information boxes, such as common name (i set it to the same as descriptive name), country code, state and city. Then press **Add new CA**

![](/Images/pfsense_6.png)

6. Press **Add new Certificate**. (This is to create the server certificate).
7. Then fill in the Descriptive Name and Common Name and press **Create new Certificate**

![](/Images/pfsense_7.png)

9. Now you need to setup the OpenVPN Server
10. Set the following settings (pictures below for reference):
	1. Description to what ever you want
	2. Interface to `WAN`
	3. Local Port to `1194`
	4. Data Encryption Algorithms to `AES-256-GCM` and `AES-128-GCM` (Ctrl + click both)
	5. IPv4 Tunnel Network (this is what network the connected devices will be on) to any private ip such as 10.10.1.0/24 (make sure to include the CIDR notation) 
	6. You can set Redirect IPv4 Gateway to force all traffic generated by the remote device through the VPN. Will make your server work harder. (I'm not using this)
	7. IPv4 Local Network (this is the network you want the remote devices to connect to) to your local network mine is 192.168.2.0. Don't forget the CIDR range
	8. Then press **Next**
	![](/Images/pfsense_10.png)
	![](/Images/pfsense_9.png)![](/Images/pfsense_8.png)
11. Add both Firewall rules and press **Next** then **Finish**
![](/Images/pfsense_11.png)
# Create User
Now we need to create a user that can be used to login to the local network remotely
1. Go **System** > **User Manager** and press **Add**
![](/Images/pfsense_18.png)
2. Set the username and password 
![](/Images/pfsense_17.png)
3. Check Certificate, set a Descriptive name and select the CA we made
![](/Images/pfsense_16.png)
4. Press **Save**
# Install OpenVPN-Client-Export Package
Not sure if this package is need but my god it helps.
1. Go to **System** > **Package Manager** > **Available Packages**
![](/Images/pfsense_15.png)
2. Search `openvpn` and click **install** on openvpn-client-export
![](/Images/pfsense_14.png)
3. Press **Confirm**
# Export VPN config
1. Go to **VPN** > **OpenVPN** then **Client Export**
![](/Images/pfsense_13.png)
2. Scroll all the way down and you will see the certificate we made. Press inline configurations Most Clients
![](/Images/pfsense_12.png)
3. Get the downloaded file over to your remote device. (I used google drive)
# Connecting
## Linux
1. Update and install openvpn client. For Rocky:
	1. `sudo dnf update`
	2. `sudo dnf install epel-release`
	3. `sudo dnf install openvpn`
	4. `sudo dnf install NetworkManager-openvpn`
	5. `sudo dnf install NetworkManager-openvpn-gnome`
Connect using openvpn `openvpn ./cert.ovpn`
2. Enter the username and password for the account we made
## Windows
1. Install openvpn client (https://openvpn.net/client/)
2. Load the .ovpn config
3. connect
## Troubleshooting
- Make sure  to disable **Block private networks and loopback addresses** on the WAN interface
![](/Images/troubleshoot_2.png)
- Set network to `Private` on Windows

![](/Images/troubleshoot_1.png)

If they both fail a good idea is to allow ping requests and replies on the WAN interface. Then try to get them to work by disabling firewalls, checking network configs, etc.
